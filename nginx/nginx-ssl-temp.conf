# Nginx config tạm thời cho lần đầu setup SSL
# File này được dùng trước khi có SSL certificate từ Let's Encrypt
# 
# CÁCH SỬ DỤNG:
# 1. Thay thế "yourdomain.com" bằng domain thật của bạn
# 2. Copy file này thành nginx-ssl.conf: cp nginx-ssl-temp.conf nginx-ssl.conf
# 3. Khởi động nginx: docker-compose -f docker-compose.ssl.yml up -d nginx-ssl
# 4. Chạy script init-letsencrypt.sh để lấy certificate
# 5. Sau khi có certificate, cập nhật lại nginx-ssl.conf với config đầy đủ

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Giới hạn upload file size
    client_max_body_size 100M;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript 
               application/x-javascript application/xml+rss 
               application/javascript application/json;

    # HTTP Server - Chỉ để Let's Encrypt verify domain
    server {
        listen 80;
        server_name api.halocrms.io.vn admin.halocrms.io.vn halocrms.io.vn;
        
        # Let's Encrypt challenge endpoint
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }

        # Tạm thời trả về message (sẽ redirect HTTPS sau khi có certificate)
        location / {
            return 200 "Waiting for SSL certificate setup...\nPlease run: bash scripts/init-letsencrypt.sh";
            add_header Content-Type text/plain;
        }
    }
}

